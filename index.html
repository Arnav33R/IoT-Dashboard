<!DOCTYPE html>
<html>
  <head>
    <title>IoT Dashboard</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="old-styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  </head>

  <body>
    <div class="header">
      <h3>IoT Dashboard for Smart Plant Pot</h3>
    </div>

    <div class="container">
      <div class="row">
        <div class="item" id="1">
          <label for="selected-sensor" class="label"
            ><h3>Select sensor data:</h3></label
          >

          <div class="select">
            <select id="selected-sensor">
              <option value="temperaturec">Temperature C°</option>
              <option value="temperaturef">Temperature F°</option>
              <option value="humidity">Relative Humidity</option>
              <option value="light">Light Intensity</option>
              <option value="moisture">Soil Moisture</option>
            </select>
          </div>
        </div>

        <div class="item" id="2">
          <label class="label"><h3>Click to update data:</h3></label>
          <div class="ub">
            <div class="button">Update data</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="longItem">
          <h2>Last 10 Readings</h2>
          <!-- Making charts directly accessible is usually incredibly difficult. Since this one is simple (just two axes, one data stream, no interactivity), it can be hidden (`aria-hidden="true"`) and its data made available in the following <table>. -->
          <canvas id="liveChart" height="100px" aria-hidden="true"></canvas>

          <!-- Charts are just visualizations of tabular data, so presenting that data in <table>s is easy. By default, tables are really easy for screen reader users to navigate thanks to specialized key commands, so we get some free functionality by using them! -->
          <div id="sensor-data" class="visually-hidden">
            <caption>
              Temperature vs Reading No.
            </caption>
            <!-- Captions help contextualize data, especially in a case like this where the only other textual info is the h2 above -->
          </div>
        </div>
      </div>
      <div class="row">
        <div class="tallItem">
         <h3>Data Highlights</h3>
         Last read value: 15 </br>
         Last read time:  16:18:17 </br>
         Last read date: 2023-02-11 </br> 
        </div>
        <div class="tallItem"><form>
            <label for="data">Data Reading:</label><br>
            <input list="data"><br>
            <datalist id="data">
                <option value="Temperature">
                <option value="Relative Humidity">
                <option value="Light Intensity">
                <option value="Soil Moisture">
              </datalist>

            <label for="comp">Comparison type</label><br>
            <input list="comp">
            <datalist id="comp">
                <option value=">">
                <option value=">=">
                <option value="<">
                <option value="<=">
                <option value="=">
              </datalist>

            <label for="value">Value</label><br>
            <input type="number" text="value">
            </br></br>
            <div class="button">Create Trigger</div>
          </form></div>
      </div>
    </div>

    <div id="app"></div>
    <script>
var xyValues = [
  { x: 1, y: 28 },
  { x: 2, y: 26 },
  { x: 3, y: 25 },
  { x: 4, y: 29 },
  { x: 5, y: 32 },
  { x: 6, y: 23 },
  { x: 7, y: 14 },
  { x: 8, y: 24 },
  { x: 9, y: 11 },
  { x: 10, y: 15 }
];

const chart = new Chart("liveChart", {
  type: "scatter",
  data: {
    datasets: [
      {
        pointRadius: 4,
        label: 'Temperature (°F)', 
        pointBackgroundColor: "rgb(0,0,255)",
        data: xyValues
      }
    ]
  },
  options: {
    legend: { display: false },
    scales: {
      xAxes: [{ ticks: { min: 0, max: 15 } }],
      yAxes: [{ ticks: { min: 0, max: 100 } }]
    }
  }
});


var myTimer = setInterval(getTemp, 15000);

function tempReply(response) {
    xyValues.push({x: xyValues[xyValues.length-1].x + 1, y: response });
    chart.data.datasets[0].data = xyValues;
    chart.update();
}

function getTemp() {
  httpGet("/temp", tempReply);
}

function httpGet(path, callback) {
  var req = new XMLHttpRequest();
  req.open("GET", path, true); 
  req.onreadystatechange = function() 
  { 
    if (req.readyState == 4)
    if(req.status == 200)
      callback(req.responseText);
    else
      callback("Waiting...");
  }
  req.send(null);
}

document.getElementById("app").innerHTML = ``;

    </script>
  </body>
</html>
